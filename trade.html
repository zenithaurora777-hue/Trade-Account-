<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade Room</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
:root{
  --bg-light:#f4f6f9; --bg-dark:#0b0b0d;
  --card-light:#fff; --card-dark:#111114;
  --text-light:#111; --text-dark:#f2f2f2;
  --muted:#9b9b9b; --line:#1f1f25; --binance:#f0b90b; --danger:#ff3b3b; --success:#00c389;
  --hold:#00bfff; --cancel:#ff4500; --paused:#ffcc00;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
body{background:var(--bg-light);color:var(--text-light);padding-bottom:90px;transition:.35s;}
body.dark{background:var(--bg-dark);color:var(--text-dark);}
.topbar{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:14px;display:flex;justify-content:space-between;align-items:center;}
body.dark .topbar{background:#0f0f12;}
.brand{display:flex;gap:10px;align-items:center;font-weight:700;}
.brand img{width:38px;height:38px;border-radius:12px;border:1px solid var(--line);}
.wrap{padding:14px;max-width:900px;margin:auto;display:grid;gap:14px;}
.card{background:var(--card-light);border:1px solid var(--line);border-radius:20px;padding:14px;transition:.35s;}
body.dark .card{background:var(--card-dark);}
.value{font-size:28px;font-weight:900;color:var(--binance);transition:.25s;}
.profit{font-size:22px;font-weight:900;margin-top:10px;transition:.35s;}
.green{color:var(--success);}
.red{color:var(--danger);}
.paused{color:var(--paused);}
.btn{width:100%;padding:12px;border-radius:14px;border:none;font-weight:900;background:var(--binance);margin-top:10px;cursor:pointer;color:black;}
.btn.hold{background:var(--hold);color:#fff;}
.btn.cancel{background:var(--cancel);color:#fff;}
select,input{padding:8px;border-radius:10px;background:#fff;color:#111;border:1px solid var(--line);}
body.dark select,body.dark input{background:#0f0f12;color:white;}
.progress-bar{height:10px;background:#222;border-radius:10px;overflow:hidden;margin-top:10px;}
.progress-fill{height:100%;width:0%;background:var(--binance);transition:width 1s linear;}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid var(--line);display:flex;justify-content:space-around;padding:10px;}
body.dark .bottom-nav{background:#0f0f12;}
.nav-item{display:flex;flex-direction:column;align-items:center;font-size:11px;color:var(--muted);text-decoration:none;}
.nav-item.active{color:var(--binance);}
.theme{position:absolute;top:12px;right:12px;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px;background:#eee;color:#111;transition:.35s;}
body.dark .theme{background:#222;color:white;}

/* Animated Signal Styles */
.signal-wrap{background:#101722;border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:0 10px 40px rgba(0,0,0,.35);}
.signal-top{display:flex;justify-content:space-between;align-items:flex-start;}
.signal h2{font-size:15px;margin-bottom:4px;}
.signal small{color:#9aa4b2;font-size:12px;}
.price{text-align:right;}
.price .p{font-size:18px;font-weight:800;}
.price .chg{font-size:12px;font-weight:700;}
.chg.up{color:#00c087;}
.chg.down{color:#f6465d;}
.chartWrap{margin:14px;background:#0f141b;border:1px solid rgba(255,255,255,.06);border-radius:18px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,.35);}
canvas{width:100%;height:320px;display:block;}
.spacer{height:90px;}
</style>
</head>
<body>
<script>if(!localStorage.getItem("loggedin")) location.href="index.html";</script>

<div class="theme" onclick="toggleTheme()">â˜€ï¸Ž / ðŸŒ™</div>

<header class="topbar">
  <div class="brand">
    <img src="logo.png" alt="Logo">
    <div><div>Trade Room</div><span id="livePair">BTC/USDT</span></div>
  </div>
  <div style="font-weight:bold;color:#f0b90b;">$<span id="totalBalance">500</span></div>
</header>

<main class="wrap">

<section class="card">
  <h3>Select Pair</h3>
  <select id="pairSelect" onchange="changePair(this.value)">
    <option value="BINANCE:BTCUSDT">BTC/USDT</option>
    <option value="BINANCE:ETHUSDT">ETH/USDT</option>
    <option value="BINANCE:SOLUSDT">SOL/USDT</option>
    <option value="BINANCE:BNBUSDT">BNB/USDT</option>
    <option value="BINANCE:ETHBTC">ETH/BTC</option>
    <option value="BINANCE:BTCETH">BTC/ETH</option>
    <option value="BINANCE:BNBBTC">BNB/BTC</option>
  </select>
</section>

<section class="card signal-wrap">
  <div class="signal-top">
    <div>
      <h2 id="signalText">Signal: BUY</h2>
      <small id="signalDesc">Trend confirmed â€¢ Strong momentum</small>
    </div>
    <div class="price">
      <div class="p" id="signalPrice">50000</div>
      <div class="chg up" id="signalChange">+0.00%</div>
    </div>
  </div>
</section>

<section class="card chartWrap">
  <canvas id="chart"></canvas>
</section>

<section class="card">
  <h3>AI Trade Signal</h3>
  <label>Trade Duration (7â€“180 days)</label>
  <input type="number" id="duration" min="7" max="180" value="30">
  <p>Entry: <span id="entry">--</span></p>
  <p>Stop Loss: <span id="sl">--</span></p>
  <p>Take Profit: <span id="tp">--</span></p>
  <p>Signal Confidence: <span id="confidence">--</span></p>
  <button class="btn" id="startBtn" onclick="startTrade()">Start Trade</button>
  <button class="btn hold" id="holdBtn" onclick="toggleHold()">Hold Trade</button>
  <button class="btn cancel" onclick="cancelTrade()">Cancel Trade</button>
  <div class="profit" id="profit">+$0</div>
  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  <div id="countdown">Withdrawal unlocks in: --</div>
</section>

<section class="card">
  <h3>Total Balance</h3>
  <div class="value" id="bal">$500</div>
  <button class="btn" id="withdrawBtn" onclick="withdraw()" disabled>Withdraw</button>
  <button class="btn" onclick="showHistory()">Wallet History</button>
</section>

</main>

<nav class="bottom-nav">
  <a class="nav-item" href="home.html"><span class="material-icons">home</span>Home</a>
  <a class="nav-item active" href="trade.html"><span class="material-icons">swap_horiz</span>Trade</a>
  <a class="nav-item" href="index.html" onclick="logout()"><span class="material-icons">logout</span>Logout</a>
</nav>

<script>
let currentSymbol="BINANCE:BTCUSDT";
let tradeInterval, progressInterval, countdownInterval, profitInterval, tradeEndTime, tradeActive=false, holdActive=false;
const CAPITAL=500;
let balance=CAPITAL;
let additionalProfit=0;
let nextProfitTime=Date.now()+20*60*1000; // first $130 in 20 minutes
document.getElementById("bal").innerText="$"+balance;

// Pair Change
function changePair(symbol){
  currentSymbol=symbol;
  document.getElementById("livePair").innerText=symbol.replace("BINANCE:","").replace("USDT","/USDT");
}

// Countdown
function updateCountdown(){
  if(!tradeEndTime){document.getElementById("countdown").innerText="Withdrawal unlocks in: --"; return;}
  let remaining=tradeEndTime-Date.now();
  if(remaining<=0){document.getElementById("countdown").innerText="Withdrawal unlocked!"; clearInterval(countdownInterval); document.getElementById("withdrawBtn").disabled=false; return;}
  document.getElementById("countdown").innerText=`Withdrawal unlocks in: ${Math.ceil(remaining/1000)}s`;
}

// Start Trade
function startTrade(){
  if(tradeActive) return;
  tradeActive=true; holdActive=false; document.getElementById("withdrawBtn").disabled=true;
  document.getElementById("holdBtn").innerText="Hold Trade";
  let price=Number(document.getElementById("signalPrice").innerText);
  document.getElementById("entry").innerText="$"+price.toFixed(2);
  document.getElementById("sl").innerText="$"+(price*0.99).toFixed(2);
  document.getElementById("tp").innerText="$"+(price*1.02).toFixed(2);
  tradeEndTime=Date.now()+604800*1000; // 7 days
  clearInterval(progressInterval); clearInterval(countdownInterval); clearInterval(profitInterval);
  countdownInterval=setInterval(updateCountdown,1000); updateCountdown();
  let startTime=Date.now();
  progressInterval=setInterval(()=>{
    document.getElementById("progressFill").style.width=Math.min(((Date.now()-startTime)/(604800*1000))*100,100)+"%";
  },1000);
  startProfitLoop();
}

// Toggle Hold / Continue
function toggleHold(){
  if(!tradeActive) return;
  holdActive=!holdActive;
  document.getElementById("holdBtn").innerText=holdActive?"Continue Trade":"Hold Trade";
  const balEl=document.getElementById("bal");
  if(holdActive){balEl.classList.add("paused");} else{balEl.classList.remove("paused");}
}

// Cancel Trade
function cancelTrade(){tradeActive=false; holdActive=false; document.getElementById("withdrawBtn").disabled=true; clearInterval(profitInterval); document.getElementById("bal").classList.remove("paused");}

// Withdraw
function withdraw(){if(Date.now()<tradeEndTime){alert("Withdrawal locked. Please wait until unlock."); return;} window.location.href="withdrawal.html";}

// Wallet History
function saveHistory(txt){let h=JSON.parse(localStorage.getItem("history")||"[]"); h.unshift(new Date().toLocaleString()+" â€” "+txt); localStorage.setItem("history",JSON.stringify(h));}
function showHistory(){let h=JSON.parse(localStorage.getItem("history")||"[]"); alert(h.join("\n\n")||"No history yet");}

// Logout
function logout(){localStorage.removeItem("loggedin");location.href="index.html";}

// Theme
function toggleTheme(){document.body.classList.toggle("dark");localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");}
if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark");

// Profit Loop
function startProfitLoop(){
  const profitEl=document.getElementById("profit");
  const balEl=document.getElementById("bal");
  profitInterval=setInterval(()=>{
    if(!tradeActive || holdActive){profitEl.innerText=profitEl.innerText; return;}
    let change=(Math.random()<0.5?-1:1)*Math.floor(Math.random()*10);
    profitEl.innerText=(change>=0?"+":"")+change;
    profitEl.className="profit "+(change>=0?"green":"red");
    if(change>=0){balEl.style.color="green";} else {balEl.style.color="red";}
    if(Date.now()>nextProfitTime){
      additionalProfit+=130;
      nextProfitTime=Date.now()+20*60*1000;
    }
    balEl.innerText="$"+(CAPITAL+additionalProfit);
  },5000); // slow blinking
}

// ------------------ Animated Signal Canvas ------------------
const canvas=document.getElementById("chart");
const ctx=canvas.getContext("2d");
function resizeCanvas(){const dpr=window.devicePixelRatio||1; canvas.width=canvas.clientWidth*dpr; canvas.height=canvas.clientHeight*dpr; ctx.setTransform(dpr,0,0,dpr,0,0);}
window.addEventListener("resize",resizeCanvas);
const W=()=>canvas.clientWidth; const H=()=>canvas.clientHeight;
const maxCandles=60; const candles=[];
let basePrice=50000; let lastClose=basePrice;
function rand(min,max){return Math.random()*(max-min)+min;}
for(let i=0;i<maxCandles;i++){const open=lastClose; const close=open+rand(-500,500); const high=Math.max(open,close)+rand(50,200); const low=Math.min(open,close)-rand(50,200); candles.push({open,high,low,close}); lastClose=close;}
let scrollOffset=0; const scrollSpeed=0.18;
function drawGrid(){ctx.fillStyle="#0f141b"; ctx.fillRect(0,0,W(),H()); ctx.strokeStyle="rgba(255,255,255,0.05)"; ctx.lineWidth=1; for(let i=1;i<8;i++){let x=(W()/8)*i; ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H()); ctx.stroke();} for(let j=1;j<6;j++){let y=(H()/6)*j; ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W(),y); ctx.stroke();}}
function getPriceRange(){let min=Infinity,max=-Infinity; for(const c of candles){if(c.low<min) min=c.low; if(c.high>max) max=c.high;} const pad=(max-min)*0.08; return {min:min-pad,max:max+pad};}
function priceToY(price,range){return H()-((price-range.min)/(range.max-range.min))*H();}
function drawCandles(){const range=getPriceRange(); const candleSpacing=W()/maxCandles; const candleWidth=candleSpacing*0.55; for(let i=0;i<candles.length;i++){const c=candles[i]; const xCenter=i*candleSpacing+candleSpacing/2-scrollOffset; if(xCenter<-50||xCenter>W()+50) continue; const openY=priceToY(c.open,range); const closeY=priceToY(c.close,range); const highY=priceToY(c.high,range); const lowY=priceToY(c.low,range); const isBull=c.close>=c.open; const bodyTop=Math.min(openY,closeY); const bodyBottom=Math.max(openY,closeY); const bodyHeight=Math.max(2,bodyBottom-bodyTop); ctx.strokeStyle="rgba(255,255,255,0.18)"; ctx.lineWidth=1.3; ctx.beginPath(); ctx.moveTo(xCenter,highY); ctx.lineTo(xCenter,lowY); ctx.stroke(); ctx.fillStyle=isBull?"#00c087":"#f6465d"; ctx.fillRect(xCenter-candleWidth/2,bodyTop,candleWidth,bodyHeight);}}
function addNewCandle(){const last=candles[candles.length-1]; const open=last.close; const drift=rand(-50,50); const close=open+drift+rand(-200,200); const high=Math.max(open,close)+rand(50,200); const low=Math.min(open,close)-rand(50,200); candles.push({open,high,low,close}); if(candles.length>maxCandles) candles.shift(); updateSignalPrice(close);}
function updateSignalPrice(price){const el=document.getElementById("signalPrice"); el.textContent=price.toFixed(2); const first=candles[0].open; const change=((price-first)/first)*100; const chgEl=document.getElementById("signalChange"); chgEl.textContent=(change>=0?"+":"")+change.toFixed(2)+"%"; chgEl.className="chg "+(change>=0?"up":"down");}
function animate(){drawGrid(); drawCandles(); scrollOffset+=scrollSpeed; const candleSpacing=W()/maxCandles; if(scrollOffset>=candleSpacing){scrollOffset=0; addNewCandle();} requestAnimationFrame(animate);}
resizeCanvas(); updateSignalPrice(candles[candles.length-1].close); animate();
</script>
</body>
  </html>
