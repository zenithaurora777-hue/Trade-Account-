<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade Room</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
:root{
--bg-light:#f4f6f9; --bg-dark:#0b0b0d;
--card-light:#fff; --card-dark:#111114;
--text-light:#111; --text-dark:#f2f2f2;
--muted:#9b9b9b; --line:#1f1f25;
--binance:#f0b90b; --danger:#ff3b3b; --success:#00c389;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,Segoe UI,Roboto;}
body{background:var(--bg-light);color:var(--text-light);padding-bottom:90px;transition:.35s;}
body.dark{background:var(--bg-dark);color:var(--text-dark);}
.topbar{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:14px;display:flex;justify-content:space-between;align-items:center;}
body.dark .topbar{background:#0f0f12;}
.brand{display:flex;gap:10px;align-items:center;font-weight:700;}
.brand img{width:38px;height:38px;border-radius:12px;border:1px solid var(--line);}
.wrap{padding:14px;max-width:900px;margin:auto;display:grid;gap:14px;}
.card{background:var(--card-light);border:1px solid var(--line);border-radius:20px;padding:14px;}
body.dark .card{background:var(--card-dark);}
.btn{width:100%;padding:12px;border-radius:14px;border:none;font-weight:900;margin-top:10px;cursor:pointer;}
.btn.start{background:#f0b90b;color:#000;}
.btn.cancel{background:#ff3b3b;color:#fff;}
#holdBtn{background:#38bdf8;color:#fff;}
.balanceBox{font-size:30px;font-weight:900;margin-top:10px;}
#profit{font-size:22px;font-weight:900;margin-top:10px;transition:.2s;}
.up{color:#00c853;animation:flash .5s;}
.down{color:#ff3d00;animation:flash .5s;}
@keyframes flash{0%{opacity:.2}100%{opacity:1}}
</style>
</head>
<body>

<script>if(!localStorage.getItem("loggedin")) location.href="index.html";</script>

<header class="topbar">
<div class="brand">
<img src="logo.png">
<div>Trade Room<br><small id="livePair">BTC/USDT</small></div>
</div>
<div style="font-weight:bold;color:#f0b90b;">$<span id="totalBalance">500.00</span></div>
</header>

<main class="wrap">
<section class="card">
<h3>AI Trade</h3>

<button class="btn start" id="tradeBtn" onclick="toggleTrade()">Start Trade</button>
<button class="btn" id="holdBtn" onclick="toggleHold()">Hold Trade</button>

<div id="profit">+$0.00</div>
<div id="liveBalance" class="balanceBox">Balance: $500.00</div>
</section>
</main>

<script>

/* CONSTANTS */
const START = 500;
const TARGET_GAIN = 130;
const DURATION = 5 * 60 * 1000;
const MAX_DROP = 0.2 * START;

/* STATE (persistent) */
let tradeActive = localStorage.tradeActive === "true";
let holdActive = localStorage.holdActive === "true";
let profitValue = Number(localStorage.profitValue || 0);
let balance = Number(localStorage.balance || START);
let cycleStart = Number(localStorage.cycleStart || 0);

let profitLoop;
let balanceLagTimer;

/* SAVE STATE */
function saveState(){
localStorage.tradeActive = tradeActive;
localStorage.holdActive = holdActive;
localStorage.profitValue = profitValue;
localStorage.balance = balance;
localStorage.cycleStart = cycleStart;
}

/* UI HELPERS */
function setBalance(v){
balance = v < START ? START : v;
totalBalance.textContent = balance.toFixed(2);
liveBalance.textContent = "Balance: $" + balance.toFixed(2);
saveState();
}

function blink(el,type){
el.classList.remove("up","down");
void el.offsetWidth;
el.classList.add(type);
setTimeout(()=>el.classList.remove("up","down"),500);
}

/* PROFIT ENGINE */
function runProfit(){
if(!tradeActive || holdActive) return;

let change=(Math.random()-0.5)*20;
profitValue+=change;

profit.textContent=(profitValue>=0?"+$":"-$")+Math.abs(profitValue).toFixed(2);
blink(profit, change>=0?"up":"down");

saveState();

clearTimeout(balanceLagTimer);
balanceLagTimer=setTimeout(runBalance,3000);

profitLoop=setTimeout(runProfit,2000+Math.random()*2000);
}

/* BALANCE ENGINE */
function runBalance(){
if(!tradeActive || holdActive) return;

let elapsed=Date.now()-cycleStart;
if(elapsed>=DURATION){
cycleStart=Date.now();
balance=START;
}

let progress=elapsed/DURATION;
let guaranteed=START + TARGET_GAIN*progress;

let fluctuation=(Math.random()-0.5)*40;
let tempBalance=guaranteed+fluctuation;

if(tempBalance < guaranteed-MAX_DROP)
tempBalance=guaranteed-MAX_DROP;

let diff=tempBalance-balance;
balance=tempBalance;

setBalance(balance);

blink(liveBalance, diff>=0?"up":"down");
blink(totalBalance, diff>=0?"up":"down");
}

/* TOGGLES */
function toggleTrade(){
tradeActive=!tradeActive;
holdActive=false;

if(tradeActive){
cycleStart = cycleStart || Date.now();
tradeBtn.className="btn cancel";
tradeBtn.textContent="Cancel Trade";
runProfit();
}else{
tradeBtn.className="btn start";
tradeBtn.textContent="Start Trade";
clearTimeout(profitLoop);
clearTimeout(balanceLagTimer);
profitValue=0;
balance=START;
cycleStart=0;
}

profit.textContent=(profitValue>=0?"+$":"-$")+Math.abs(profitValue).toFixed(2);
setBalance(balance);
saveState();
}

function toggleHold(){
if(!tradeActive) return;
holdActive=!holdActive;
holdBtn.textContent=holdActive?"Continue Trade":"Hold Trade";
saveState();
if(!holdActive) runProfit();
}

/* INIT ON PAGE LOAD */
function init(){
profit.textContent=(profitValue>=0?"+$":"-$")+Math.abs(profitValue).toFixed(2);
setBalance(balance);

if(tradeActive){
tradeBtn.className="btn cancel";
tradeBtn.textContent="Cancel Trade";
if(!holdActive) runProfit();
}

if(holdActive) holdBtn.textContent="Continue Trade";
}

init();

</script>

</body>
</html>
