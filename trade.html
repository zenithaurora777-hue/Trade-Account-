<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade Room</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
:root{
  --bg-light:#f4f6f9; --bg-dark:#0b0b0d;
  --card-light:#fff; --card-dark:#111114;
  --text-light:#111; --text-dark:#f2f2f2;
  --muted:#9b9b9b; --line:#1f1f25; --binance:#f0b90b; --danger:#ff3b3b; --success:#00c389;
  --hold:#00bfff; --cancel:#ff4500; --paused:#ffcc00;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
body{background:var(--bg-light);color:var(--text-light);padding-bottom:90px;transition:.35s;}
body.dark{background:var(--bg-dark);color:var(--text-dark);}
.topbar{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:14px;display:flex;justify-content:space-between;align-items:center;}
body.dark .topbar{background:#0f0f12;}
.brand{display:flex;gap:10px;align-items:center;font-weight:700;}
.brand img{width:38px;height:38px;border-radius:12px;border:1px solid var(--line);}
.wrap{padding:14px;max-width:900px;margin:auto;display:grid;gap:14px;}
.card{background:var(--card-light);border:1px solid var(--line);border-radius:20px;padding:14px;transition:.35s;}
body.dark .card{background:var(--card-dark);}
.value{font-size:28px;font-weight:900;color:var(--binance);transition:.25s;}
.profit{font-size:22px;font-weight:900;margin-top:10px;transition:.35s;}
.green{color:var(--success);}
.red{color:var(--danger);}
.paused{color:var(--paused);}
.btn{width:100%;padding:12px;border-radius:14px;border:none;font-weight:900;background:var(--binance);margin-top:10px;cursor:pointer;color:black;}
.btn.hold{background:var(--hold);color:#fff;}
.btn.cancel{background:var(--cancel);color:#fff;}
select,input{padding:8px;border-radius:10px;background:#fff;color:#111;border:1px solid var(--line);}
body.dark select,body.dark input{background:#0f0f12;color:white;}
.progress-bar{height:10px;background:#222;border-radius:10px;overflow:hidden;margin-top:10px;}
.progress-fill{height:100%;width:0%;background:var(--binance);transition:width 1s linear;}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid var(--line);display:flex;justify-content:space-around;padding:10px;}
body.dark .bottom-nav{background:#0f0f12;}
.nav-item{display:flex;flex-direction:column;align-items:center;font-size:11px;color:var(--muted);text-decoration:none;}
.nav-item.active{color:var(--binance);}
.theme{position:absolute;top:12px;right:12px;cursor:pointer;font-size:14px;padding:6px 10px;border-radius:8px;background:#eee;color:#111;transition:.35s;}
body.dark .theme{background:#222;color:white;}

/* Animated Signal Styles */
.signal-wrap{background:#101722;border-radius:16px;padding:14px;margin-bottom:14px;box-shadow:0 10px 40px rgba(0,0,0,.35);}
.signal-top{display:flex;justify-content:space-between;align-items:flex-start;}
.signal h2{font-size:15px;margin-bottom:4px;}
.signal small{color:#9aa4b2;font-size:12px;}
.price{text-align:right;}
.price .p{font-size:18px;font-weight:800;}
.price .chg{font-size:12px;font-weight:700;}
.chg.up{color:#00c087;}
.chg.down{color:#f6465d;}
.chartWrap{margin:14px;background:#0f141b;border:1px solid rgba(255,255,255,.06);border-radius:18px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,.35);}
canvas{width:100%;height:320px;display:block;}
.spacer{height:90px;}
</style>
</head>
<body>
<script>if(!localStorage.getItem("loggedin")) location.href="index.html";</script>

<div class="theme" onclick="toggleTheme()">â˜€ï¸Ž / ðŸŒ™</div>

<header class="topbar">
  <div class="brand">
    <img src="logo.png" alt="Logo">
    <div><div>Trade Room</div><span id="livePair">BTC/USDT</span></div>
  </div>
  <div style="font-weight:bold;color:#f0b90b;">$<span id="totalBalance">500</span></div>
</header>

<main class="wrap">

<section class="card">
  <h3>Select Pair</h3>
  <select id="pairSelect" onchange="changePair(this.value)">
    <option value="BINANCE:BTCUSDT">BTC/USDT</option>
    <option value="BINANCE:ETHUSDT">ETH/USDT</option>
    <option value="BINANCE:SOLUSDT">SOL/USDT</option>
    <option value="BINANCE:BNBUSDT">BNB/USDT</option>
    <option value="BINANCE:ETHBTC">ETH/BTC</option>
    <option value="BINANCE:BTCETH">BTC/ETH</option>
    <option value="BINANCE:BNBBTC">BNB/BTC</option>
  </select>
</section>

<section class="card signal-wrap">
  <div class="signal-top">
    <div>
      <h2 id="signalText">Signal: BUY</h2>
      <small id="signalDesc">Trend confirmed â€¢ Strong momentum</small>
    </div>
    <div class="price">
      <div class="p" id="signalPrice">50000</div>
      <div class="chg up" id="signalChange">+0.00%</div>
    </div>
  </div>
</section>

<section class="card chartWrap">
  <canvas id="chart"></canvas>
</section>

<section class="card">
  <h3>AI Trade Signal</h3>
  <label>Trade Duration (7â€“180 days)</label>
  <input type="number" id="duration" min="7" max="180" value="30">
  <p>Entry: <span id="entry">--</span></p>
  <p>Stop Loss: <span id="sl">--</span></p>
  <p>Take Profit: <span id="tp">--</span></p>
  <p>Signal Confidence: <span id="confidence">--</span></p>
  <button class="btn" id="startBtn" onclick="startTrade()">Start Trade</button>
  <button class="btn hold" id="holdBtn" onclick="toggleHold()">Hold Trade</button>
  <button class="btn cancel" onclick="cancelTrade()">Cancel Trade</button>
  <div class="profit" id="profit">+$0</div>
  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  <div id="countdown">Withdrawal unlocks in: --</div>
</section>
<script>

/* ===============================
   PERSISTENT TRADE ENGINE
   (NO COMPOUND)
================================= */

let currentSymbol="BINANCE:BTCUSDT";

const CAPITAL = 500;

let tradeActive = false;
let holdActive = false;
let tradeStartTime = null;
let tradeEndTime = null;
let nextProfitTime = null;
let additionalProfit = 0;

let profitInterval, countdownInterval, progressInterval;

/* ===============================
   SAVE / LOAD STATE
================================= */

function saveState(){
  localStorage.setItem("tradeState", JSON.stringify({
    tradeActive,
    holdActive,
    tradeStartTime,
    tradeEndTime,
    nextProfitTime,
    additionalProfit
  }));
}

function loadState(){
  const saved = JSON.parse(localStorage.getItem("tradeState"));
  if(saved){
    tradeActive = saved.tradeActive;
    holdActive = saved.holdActive;
    tradeStartTime = saved.tradeStartTime;
    tradeEndTime = saved.tradeEndTime;
    nextProfitTime = saved.nextProfitTime;
    additionalProfit = saved.additionalProfit || 0;
  }
}

/* ===============================
   UPDATE BALANCE
================================= */

function updateBalance(){
  const total = CAPITAL + additionalProfit;
  document.getElementById("bal").innerText = "$" + total;
  document.getElementById("totalBalance").innerText = total;
}

/* ===============================
   START TRADE
================================= */

function startTrade(){
  if(tradeActive) return;

  tradeActive = true;
  holdActive = false;

  tradeStartTime = Date.now();
  tradeEndTime = Date.now() + 7*24*60*60*1000; // 7 days
  nextProfitTime = Date.now() + 20*60*1000; // first $130

  document.getElementById("withdrawBtn").disabled = true;
  document.getElementById("holdBtn").innerText = "Hold Trade";

  saveState();
  startLoops();
}

/* ===============================
   HOLD / CONTINUE
================================= */

function toggleHold(){
  if(!tradeActive) return;

  holdActive = !holdActive;
  document.getElementById("holdBtn").innerText =
    holdActive ? "Continue Trade" : "Hold Trade";

  saveState();
}

/* ===============================
   CANCEL TRADE
================================= */

function cancelTrade(){
  tradeActive = false;
  holdActive = false;
  clearIntervals();
  localStorage.removeItem("tradeState");
  additionalProfit = 0;
  updateBalance();
}

/* ===============================
   PROFIT CATCH-UP SYSTEM
================================= */

function calculateMissedProfits(){
  if(!tradeActive || holdActive) return;

  while(Date.now() >= nextProfitTime){
    additionalProfit += 130;
    nextProfitTime += 20*60*1000;
  }

  saveState();
}

/* ===============================
   PROFIT LOOP (BLINK ONLY)
================================= */

function startProfitLoop(){
  clearInterval(profitInterval);

  const profitEl = document.getElementById("profit");
  const balEl = document.getElementById("bal");

  profitInterval = setInterval(()=>{

    if(!tradeActive) return;

    calculateMissedProfits();
    updateBalance();

    if(holdActive){
      balEl.classList.add("paused");
      return;
    }

    let blink = (Math.random()<0.5?-1:1)*Math.floor(Math.random()*10);

    profitEl.innerText = (blink>=0?"+":"")+blink;
    profitEl.className = "profit " + (blink>=0?"green":"red");

    balEl.style.color = blink>=0 ? "green" : "red";

  },5000);

}

/* ===============================
   COUNTDOWN
================================= */

function updateCountdown(){
  if(!tradeActive){
    document.getElementById("countdown").innerText =
      "Withdrawal unlocks in: --";
    return;
  }

  const remaining = tradeEndTime - Date.now();

  if(remaining <= 0){
    document.getElementById("countdown").innerText =
      "Withdrawal unlocked!";
    document.getElementById("withdrawBtn").disabled = false;
    tradeActive = false;
    saveState();
    return;
  }

  document.getElementById("countdown").innerText =
    "Withdrawal unlocks in: " + Math.ceil(remaining/1000) + "s";
}

function startCountdown(){
  clearInterval(countdownInterval);
  countdownInterval = setInterval(updateCountdown,1000);
  updateCountdown();
}

/* ===============================
   PROGRESS BAR
================================= */

function startProgress(){
  clearInterval(progressInterval);

  progressInterval = setInterval(()=>{
    if(!tradeActive) return;

    const total = 7*24*60*60*1000;
    const elapsed = Date.now() - tradeStartTime;
    const percent = Math.min((elapsed/total)*100,100);

    document.getElementById("progressFill").style.width =
      percent + "%";

  },1000);
}

/* ===============================
   WITHDRAW
================================= */

function withdraw(){
  if(Date.now() < tradeEndTime){
    alert("Withdrawal locked. Please wait.");
    return;
  }
  window.location.href="withdrawal.html";
}

/* ===============================
   RESUME AFTER RELOAD
================================= */

function resumeTrade(){
  if(!tradeActive) return;

  calculateMissedProfits();
  updateBalance();
  startLoops();
}

function startLoops(){
  startProfitLoop();
  startCountdown();
  startProgress();
}

function clearIntervals(){
  clearInterval(profitInterval);
  clearInterval(countdownInterval);
  clearInterval(progressInterval);
}

/* ===============================
   INIT
================================= */

loadState();
updateBalance();
resumeTrade();

/* ===============================
   THEME
================================= */

function toggleTheme(){
  document.body.classList.toggle("dark");
  localStorage.setItem("theme",
    document.body.classList.contains("dark")?"dark":"light");
}

if(localStorage.getItem("theme")==="dark")
  document.body.classList.add("dark");

</script> 
<section class="card">
  <h3>Total Balance</h3>
  <div class="value" id="bal">$500</div>
  <button class="btn" id="withdrawBtn" onclick="withdraw()" disabled>Withdraw</button>
  <button class="btn" onclick="showHistory()">Wallet History</button>
</section>

</main>

<nav class="bottom-nav">
  <a class="nav-item" href="home.html"><span class="material-icons">home</span>Home</a>
  <a class="nav-item active" href="trade.html"><span class="material-icons">swap_horiz</span>Trade</a>
  <a class="nav-item" href="index.html" onclick="logout()"><span class="material-icons">logout</span>Logout</a>
</nav>


</body>
  </html>
